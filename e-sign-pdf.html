<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MJYDCHGD51"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-MJYDCHGD51');
</script>
    <!-- ============== BASIC META TAGS ============== -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Free eSign PDF Tool | Sign Documents Online</title>
    <meta name="description" content="Sign PDF documents online for free. Upload, draw, and place your signature securely. Fast, private, and no uploads required.">
    <meta name="keywords" content="esign pdf, sign pdf, electronic signature, sign document online, free pdf signer, draw signature on pdf, online signature tool">
    
    <!-- ============== SEO & SOCIAL META TAGS ============== -->
    <link rel="canonical" href="https://toolsbucket.online/esign-pdf.html">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="48x48" href="/favicon-48x48.png">
	<link rel="icon" type="image/png" sizes="64x64" href="/favicon-64x64.png">
	<link rel="icon" type="image/png" sizes="192x192" href="/favicon-192x192.png">
	<link rel="icon" type="image/png" sizes="512x512" href="/favicon-512x512.png">
	<link rel="apple-touch-icon" sizes="180x180" href="/favicon-192x192.png">
	<meta name="theme-color" content="#ffffff">
    <meta property="og:title" content="Free Online PDF eSigning Tool">
    <meta property="og:description" content="Easily add your signature to any PDF document. Our tool works in your browser, keeping your files secure and private.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://toolsbucket.online/esign-pdf.html">
    <meta property="og:image" content="https://toolsbucket.online/og-image.png">
	<!-- Twitter Card meta tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@ToolsBucket2025"> <!-- Replace with your Twitter username -->
  <meta name="twitter:title" content="ToolsBucket - Free Online Tools">
  <meta name="twitter:description" content="A collection of free, fast, and secure online utilities for PDFs, images, text, and web development.">
  <meta name="twitter:image" content="https://toolsbucket.online/ToolsBucket_banner.jpg"> <!-- Replace with your image URL -->

    <!-- External Libraries - Corrected and versioned for stability -->
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>


    <!-- ============== STYLES & FONTS ============== -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #007BFF;
            --background-color: #f4faff;
            --card-background: #ffffff;
            --text-color: #333;
            --heading-color: #0056b3;
            --border-color: #ddd;
            --shadow-color: rgba(0, 123, 255, 0.1);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Poppins', Arial, sans-serif;
            background: var(--background-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        
        .page-header {
            width: 100%;
            max-width: 1200px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .brand-name { font-size: 1.8em; font-weight: 700; }
        .brand-part-1 { color: var(--primary-color); }
        .brand-part-2 { color: #000000; }
        .back-button {
            text-decoration: none;
            background-color: var(--card-background);
            color: var(--text-color);
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            transition: background-color 0.3s;
            border: 1px solid var(--border-color);
        }
        .back-button:hover { background-color: #e9ecef; }
        
        .main-container { width: 100%; max-width: 1200px; }
        .content-section, .tool-container, footer {
            background-color: var(--card-background);
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 8px 25px var(--shadow-color);
            margin-bottom: 30px;
        }
        h1, h2 { color: var(--heading-color); margin-bottom: 15px; text-align: center; }
        h1 { font-size: 2em; }
        h2 { font-size: 1.6em; }
        
        .tool-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
        }
        @media (min-width: 992px) {
            .tool-container { grid-template-columns: 350px 1fr; }
        }

        .controls-side .step { margin-bottom: 20px; }
        .controls-side h3 { border-bottom: 2px solid var(--primary-color); padding-bottom: 5px; margin-bottom: 15px;}
        
        #signaturePad { border: 2px dashed var(--border-color); border-radius: 8px; cursor: crosshair; width: 100%; height: 150px; }
        
        .workspace-side {
            background-color: #f0f0f0;
            padding: 15px;
            border-radius: 8px;
            overflow: auto;
            max-height: 80vh;
        }
        #pdf-viewer { position: relative; }
        #pdf-viewer canvas { 
            display: block;
            margin: 0 auto 10px auto; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); 
            cursor: pointer;
        }
        #signature-image {
            position: absolute;
            cursor: move;
            display: none;
            user-select: none;
            border: 2px dashed var(--primary-color);
            touch-action: none; /* For interact.js */
        }
        
        .btn {
            background-color: var(--primary-color);
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            width: auto;
            margin: 5px;
            font-size: 16px;
            font-weight: 600;
        }
        .btn:disabled { background-color: #a0c8ff; cursor: not-allowed; }
        .btn.secondary { background-color: #6c757d; }
        
        footer { text-align: center; }
        footer h3 { font-size: 1.2em; font-weight: 600; margin-bottom: 15px; }
        footer ul { list-style: none; padding: 0; margin: 0 0 20px 0; }
        footer li { display: inline-block; margin: 0 12px; }
        footer a { color: var(--primary-color); text-decoration: none; font-weight: 600; }
        footer .footer-bottom p { font-size: 0.9em; color: #888; margin: 0; }
    </style>
	<!========Ads Section ===========>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5037596819589415"
     crossorigin="anonymous"></script>
    <!=========Ads Section ===========>
</head>
<body>
  <header class="page-header">
      <a href="index.html#tools" class="back-button">← Back to Tools</a>
      <div class="brand-name">
          <span class="brand-part-1">Tools</span><span class="brand-part-2">Bucket</span>
      </div>
  </header>

  <main class="main-container">
    <section class="content-section">
        <h1>Free Online PDF eSign Tool</h1>
        <p>Sign your PDF documents with ease using our secure and intuitive eSign tool. Whether you need to sign a contract, an application form, or any other document, our tool allows you to upload a PDF, draw your signature, and place it exactly where you need it. The best part? Everything happens directly in your browser, ensuring your files are never uploaded to a server. It's the fast, free, and private way to sign documents online.</p>
    </section>

    <div class="tool-container">
        <div class="controls-side">
            <div class="step">
                <h3>Step 1: Upload PDF</h3>
                <input type="file" id="pdfInput" accept="application/pdf" />
            </div>
            <div class="step">
                <h3>Step 2: Draw Signature</h3>
                <canvas id="signaturePad"></canvas>
                <button id="clearBtn" class="btn secondary">Clear</button>
            </div>
            <div class="step">
                <h3>Step 3: Place & Download</h3>
                <p>After signing, click on the PDF preview to place your signature. You can then drag and resize it.</p>
                <button id="downloadBtn" class="btn" disabled>Apply Signature & Download</button>
            </div>
        </div>
        
        <div class="workspace-side">
            <div id="pdf-viewer">
                <p>Upload a PDF to get started</p>
            </div>
            <img id="signature-image" alt="Your signature">
        </div>
    </div>

    <!=================Banner Ads Section ==================>
       
  		<!=================Banner Ads Section ==================>
      
    <section class="content-section">
        <h2>How to Sign Your PDF</h2>
        <ol>
            <li><strong>Upload Your PDF:</strong> Click the "Choose File" button to select a PDF from your device.</li>
            <li><strong>Draw Your Signature:</strong> Use your mouse or trackpad to draw your signature in the box provided. Click "Clear" to start over.</li>
            <li><strong>Place Your Signature:</strong> Click anywhere on the PDF preview where you want to add your signature. You can then drag it to the perfect position and resize it by dragging its corners.</li>
            <li><strong>Download:</strong> Click the "Apply Signature & Download" button to save your newly signed PDF.</li>
        </ol>
    </section>

	  <section class="content-section">
        <h2>Unlocking Efficiency: Your Free Online PDF eSign Tool</h2>
        <p>In today's fast-paced digital world, the need for quick, secure, and efficient document handling is paramount. Our Free Online PDF eSign Tool is designed to meet this demand, offering a seamless solution for anyone looking to sign PDF documents electronically without the hassle of printing, signing, and scanning. This innovative browser-based application empowers you to apply your unique digital signature to any PDF, ensuring authenticity and saving valuable time and resources. Whether you're a business professional, a student, or simply managing personal documents, our eSign tool simplifies your workflow and keeps your information private.</p>

        <h3>What Our eSign PDF Tool Does</h3>
        <p>Our eSign PDF tool provides a comprehensive platform for electronically signing your PDF documents directly within your web browser. The core functionality revolves around three simple steps: uploading your PDF, creating a custom signature, and securely placing it onto your document. Unlike many other online tools, we prioritize your privacy and data security above all else. This means your files are processed client-side – they are never uploaded to our servers, ensuring that your sensitive information remains entirely on your device. This commitment to privacy makes our tool a trustworthy choice for all your eSigning needs.</p>
        <p>You can effortlessly draw your signature using a mouse, trackpad, or even a touchscreen device. Once created, this signature can be inserted onto any page of your uploaded PDF. The tool offers intuitive controls, allowing you to drag, reposition, and resize your signature to fit perfectly within your document's layout. After finalizing the placement, a single click downloads the modified PDF directly to your computer, complete with your embedded signature. It’s a complete solution for digital signing, eliminating the need for any third-party software installations.</p>

        <h3>How to Use Our Free PDF Signer</h3>
        <p>Signing your PDF document with our tool is incredibly straightforward. Follow these simple steps to experience the ease of digital signing:</p>
        <ol>
            <li><strong>Step 1: Upload Your PDF Document.</strong> Begin by clicking the "Choose File" button located in the "Step 1: Upload PDF" section. A file explorer window will open, allowing you to select the PDF document from your local device that you wish to sign. Our tool supports standard PDF formats, ensuring compatibility with most documents. Once selected, your PDF will quickly render in the preview area, ready for signing.</li>
            <li><strong>Step 2: Draw Your Electronic Signature.</strong> Move to the "Step 2: Draw Signature" section. Here, you'll find a dedicated canvas labeled "signaturePad." Use your mouse, trackpad, or finger (if on a touch-enabled device) to draw your signature as naturally as you would on paper. Take your time to get it right; if you make a mistake or wish to refine your signature, simply click the "Clear" button to erase and start fresh.</li>
            <li><strong>Step 3: Place and Adjust Your Signature.</strong> After you've drawn your signature, it's time to place it on your PDF. Click anywhere on the rendered PDF preview where you want your signature to initially appear. Your drawn signature will instantly pop up on the document. Our tool then allows for complete customization: you can click and drag the signature image to precisely position it, and use the corner handles to resize it to your desired dimensions without distorting the aspect ratio.</li>
            <li><strong>Step 4: Apply and Download Your Signed PDF.</strong> Once you are satisfied with the placement and size of your signature, click the "Apply Signature & Download" button. Our tool will then embed your signature into the PDF document. A new, signed PDF file will be automatically downloaded to your device, typically appearing in your browser's default downloads folder. The original PDF remains untouched, and you now have a digitally signed copy ready for sharing or archival.</li>
        </ol>

        <h3>Benefits of Using Our Online eSign Tool</h3>
        <p>Choosing our Free Online PDF eSign Tool offers a multitude of advantages for both individuals and businesses:</p>
        <ul>
            <li><strong>Absolute Privacy & Security:</strong> This is our strongest commitment. All PDF processing and signature embedding occurs entirely within your web browser. Your sensitive documents never leave your device and are never transmitted to our servers. This client-side processing guarantees maximum privacy and peace of mind, making it ideal for confidential documents.</li>
            <li><strong>Completely Free to Use:</strong> Our tool is 100% free, with no hidden costs, subscriptions, or limitations on the number of documents you can sign. Enjoy full functionality without financial commitment.</li>
            <li><strong>No Software Installation Required:</strong> As a web-based application, there's no need to download or install any software. Access it directly from your browser, saving valuable disk space and avoiding potential software compatibility issues.</li>
            <li><strong>User-Friendly Interface:</strong> Designed with simplicity in mind, our intuitive interface makes the eSigning process accessible to everyone, regardless of technical proficiency. The step-by-step approach guides you through each stage effortlessly.</li>
            <li><strong>Time and Cost Efficiency:</strong> Eliminate the traditional method of printing, signing, scanning, and emailing documents. Our tool streamlines the process, saving you time, paper, ink, and scanner maintenance costs.</li>
            <li><strong>Portability and Accessibility:</strong> Sign documents from anywhere, at any time, on any device with an internet connection and a modern web browser. This flexibility is crucial for remote work and on-the-go professionals.</li>
            <li><strong>Eco-Friendly Solution:</strong> By reducing the need for printing, you contribute to a more sustainable environment, cutting down on paper waste and energy consumption.</li>
            <li><strong>Real-time Signature Placement:</strong> See your signature appear on the PDF instantly and adjust its position and size in real-time, ensuring precise and professional results every time.</li>
        </ul>

        <h3>Frequently Asked Questions (FAQs)</h3>
        <p>Here are some common questions about our Free Online PDF eSign Tool:</p>
        <div class="faq-item">
            <h4>Q: Is this tool truly free?</h4>
            <p>A: Yes, absolutely! Our eSign PDF tool is completely free to use, with no hidden costs, subscriptions, or premium features. You can sign as many documents as you need without any limitations.</p>
        </div>
        <div class="faq-item">
            <h4>Q: Are my documents safe and private?</h4>
            <p>A: Your privacy is our top priority. All document processing, including the rendering of your PDF and the application of your signature, occurs directly within your web browser. Your files are never uploaded to our servers, ensuring that your sensitive information remains entirely on your device. This client-side processing provides maximum security and confidentiality.</p>
        </div>
        <div class="faq-item">
            <h4>Q: Do I need to install any software?</h4>
            <p>A: No, you do not. Our tool is entirely web-based, meaning you can access and use it directly from any modern web browser (like Chrome, Firefox, Edge, Safari) without the need to download or install any additional software or plugins.</p>
        </div>
        <div class="faq-item">
            <h4>Q: Can I use this tool on my mobile device?</h4>
            <p>A: Yes! Our eSign PDF tool is designed to be responsive and works seamlessly across various devices, including desktops, laptops, tablets, and smartphones. You can draw your signature using your finger on a touchscreen device.</p>
        </div>
        <div class="faq-item">
            <h4>Q: What if I make a mistake while drawing my signature?</h4>
            <p>A: No problem at all! Simply click the "Clear" button below the signature pad. This will erase your current drawing, allowing you to start over and draw your signature again until you are satisfied.</p>
        </div>
        <div class="faq-item">
            <h4>Q: Can I resize or move my signature after placing it?</h4>
            <p>A: Yes, absolutely. Once you've clicked on the PDF preview to place your signature, it will appear with a dashed border. You can then click and drag the signature image to reposition it anywhere on the page. To resize, simply drag any of the corners of the signature image, and it will scale proportionally.</p>
        </div>
        <div class="faq-item">
            <h4>Q: What PDF versions are supported?</h4>
            <p>A: Our tool utilizes robust PDF.js and pdf-lib libraries, which support a wide range of PDF versions and features, from basic documents to more complex ones. If you encounter an issue with a specific PDF, it might be corrupted or password-protected.</p>
        </div>
        <div class="faq-item">
            <h4>Q: What happens to my original PDF file?</h4>
            <p>A: Your original PDF file remains unchanged on your device. When you click "Apply Signature & Download," a new PDF file with the embedded signature is created and downloaded, leaving your original document intact.</p>
        </div>
        <div class="faq-item">
            <h4>Q: Is an electronic signature legally binding?</h4>
            <p>A: The legal enforceability of electronic signatures varies by jurisdiction and the specific context of the document. In many countries, including the United States (ESIGN Act) and the European Union (eIDAS Regulation), simple electronic signatures are legally recognized. However, for highly sensitive legal documents, you may want to consult with a legal professional to ensure compliance with specific regulations.</p>
        </div>
    </section>
	  </===================Ads Section==================>
	
	</====================Ads Section=================>
    <footer id="contact">
        <h3>Quick Links</h3>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="index.html#tools">All Tools</a></li>
            <li><a href="privacy-policy.html">Privacy Policy</a></li>
            <li><a href="terms-&-conditions.html">Terms of Use</a></li>
            <li><a href="about.html">About</a></li>
        </ul>
        <div class="footer-bottom">
            <p>© 2025 ToolsBucket. All rights reserved.</p>
        </div>
    </footer>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
    const { PDFDocument } = PDFLib;
    const pdfjsLib = window['pdfjs-dist/build/pdf'];
    pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js`;

    const pdfInput = document.getElementById("pdfInput");
    const signaturePadCanvas = document.getElementById("signaturePad");
    const pdfViewer = document.getElementById("pdf-viewer");
    const clearBtn = document.getElementById("clearBtn");
    const downloadBtn = document.getElementById("downloadBtn");
    const signatureImage = document.getElementById('signature-image');
    
    const signaturePad = new SignaturePad(signaturePadCanvas);
    let pdfFile = null;
    let currentPdfDoc = null; // Store pdfjsDoc for easy page access
    let signaturePageInfo = null; // To store { pageNumber, x, y, width, height } relative to PDF.js canvas

    function resizeCanvas() {
        const ratio = Math.max(window.devicePixelRatio || 1, 1);
        signaturePadCanvas.width = signaturePadCanvas.offsetWidth * ratio;
        signaturePadCanvas.height = signaturePadCanvas.offsetHeight * ratio;
        signaturePadCanvas.getContext("2d").scale(ratio, ratio);
        signaturePad.clear();
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    const renderPdf = async (file) => {
        pdfViewer.innerHTML = '<p>Loading PDF...</p>';
        try {
            const data = await file.arrayBuffer();
            pdfFile = data; // Store the raw buffer for pdf-lib
            
            const pdfjsDoc = await pdfjsLib.getDocument({ data }).promise;
            currentPdfDoc = pdfjsDoc; // Store the pdfjsDoc
            pdfViewer.innerHTML = ''; 

            for (let i = 1; i <= pdfjsDoc.numPages; i++) {
                const page = await pdfjsDoc.getPage(i);
                const viewport = page.getViewport({ scale: 1.5 }); // Use a consistent scale for rendering
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                canvas.height = viewport.height;
                canvas.width = viewport.width;
                canvas.dataset.pageNumber = i;
				canvas.classList.add('pdf-page-canvas'); // Add this line
                
                await page.render({ canvasContext: context, viewport: viewport }).promise;
                pdfViewer.appendChild(canvas);

                canvas.addEventListener('click', (e) => {
                    if (signaturePad.isEmpty()) {
                        alert('Please draw your signature first.');
                        return;
                    }
                    
                    const rect = canvas.getBoundingClientRect();
                    // Click coordinates relative to the clicked canvas
                    const xRelativeToCanvas = e.clientX - rect.left;
                    const yRelativeToCanvas = e.clientY - rect.top;

                    const sigInitialWidth = 150;
                    const sigInitialHeight = 75;

                    signatureImage.style.display = 'block';
                    signatureImage.src = signaturePad.toDataURL();
                    signatureImage.style.width = `${sigInitialWidth}px`;
                    signatureImage.style.height = `${sigInitialHeight}px`;

                    // Position signature image relative to pdfViewer (its parent)
                    // Center the signature where clicked
                    const absoluteX = canvas.offsetLeft + xRelativeToCanvas - (sigInitialWidth / 2);
                    const absoluteY = canvas.offsetTop + yRelativeToCanvas - (sigInitialHeight / 2);
                    
                    signatureImage.style.transform = `translate(${absoluteX}px, ${absoluteY}px)`;
                    signatureImage.setAttribute('data-x', absoluteX);
                    signatureImage.setAttribute('data-y', absoluteY);
                    
                    // Store initial placement info
                    signaturePageInfo = {
                        pageNumber: parseInt(canvas.dataset.pageNumber),
                        // These will be updated by interact.js during drag/resize
                        x: xRelativeToCanvas - (sigInitialWidth / 2), 
                        y: yRelativeToCanvas - (sigInitialHeight / 2),
                        width: sigInitialWidth,
                        height: sigInitialHeight,
                        canvas: canvas // Reference to the canvas it was placed on
                    };

                    pdfViewer.appendChild(signatureImage);
                    downloadBtn.disabled = false;
                });
            }
        } catch (error) {
            console.error("Failed to load PDF:", error);
            pdfViewer.innerHTML = '<p>Error: Could not load the PDF file. It might be corrupted or protected.</p>';
        }
    };

    pdfInput.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (file && file.type === "application/pdf") {
            renderPdf(file);
            signatureImage.style.display = 'none'; // Hide existing signature on new PDF load
            signaturePageInfo = null; // Clear old signature info
            downloadBtn.disabled = true;
        } else {
            alert("Please upload a valid PDF file.");
        }
    });

    clearBtn.addEventListener("click", () => signaturePad.clear());

    downloadBtn.addEventListener("click", async () => {
        if (!pdfFile || !signaturePageInfo || signatureImage.style.display === 'none') {
            alert("Please upload a PDF and place your signature first.");
            return;
        }

        try {
            downloadBtn.disabled = true;
            downloadBtn.textContent = 'Applying...';
            
            const pdfDoc = await PDFDocument.load(pdfFile);
            const signatureImgPng = await pdfDoc.embedPng(signatureImage.src);
            
            const targetPagePdfLib = pdfDoc.getPages()[signaturePageInfo.pageNumber - 1]; // pdf-lib is 0-indexed
            const originalPdfjsPage = await currentPdfDoc.getPage(signaturePageInfo.pageNumber);
            const originalPdfjsViewport = originalPdfjsPage.getViewport({ scale: 1.5 }); // Use same scale as rendering
            
            // Calculate scale factor from rendered canvas to actual PDF page size
            const scaleX = targetPagePdfLib.getWidth() / signaturePageInfo.canvas.offsetWidth;
            const scaleY = targetPagePdfLib.getHeight() / signaturePageInfo.canvas.offsetHeight;
            
            // Get current transform values from signatureImage
            const transformMatrix = new WebKitCSSMatrix(window.getComputedStyle(signatureImage).transform);
            const currentSigX = transformMatrix.m41; // translate X
            const currentSigY = transformMatrix.m42; // translate Y
            
            // Calculate signature's top-left corner relative to its *target PDF.js canvas*
            // signatureImage.offsetLeft/Top are relative to pdfViewer.
            // signaturePageInfo.canvas.offsetLeft/Top are relative to pdfViewer.
            const sigXRelativeToCanvas = currentSigX - signaturePageInfo.canvas.offsetLeft;
            const sigYRelativeToCanvas = currentSigY - signaturePageInfo.canvas.offsetTop;

            // Apply the scale to convert from display pixels to PDF points
            const sigWidthPdf = signatureImage.offsetWidth * scaleX;
            const sigHeightPdf = signatureImage.offsetHeight * scaleY; // Use scaleY for height

            const sigX = sigXRelativeToCanvas * scaleX;
            // pdf-lib's origin is bottom-left, so we need to invert the Y coordinate
            // Y position relative to the bottom of the PDF page
            const sigY = targetPagePdfLib.getHeight() - (sigYRelativeToCanvas * scaleY) - sigHeightPdf;

            page.drawImage(signatureImgPng, {
                x: sigX,
                y: sigY,
                width: sigWidthPdf,
                height: sigHeightPdf,
            });

            const signedPdfBytes = await pdfDoc.save();
            const blob = new Blob([signedPdfBytes], { type: "application/pdf" });
            const url = URL.createObjectURL(blob);

            const a = document.createElement("a");
            a.href = url;
            a.download = "signed-document.pdf";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

        } catch (err) {
            console.error("Error signing PDF: ", err);
            // Use a more user-friendly modal or error display
            alert("An error occurred while applying the signature. Please try again. Details: " + err.message);
        } finally {
            downloadBtn.disabled = false;
            downloadBtn.textContent = 'Apply Signature & Download';
        }
    });

    // Make the signature resizable and draggable
    interact('#signature-image')
        .resizable({
            edges: { left: true, right: true, bottom: true, top: true },
            listeners: {
                move(event) {
                    const target = event.target;
                    let x = (parseFloat(target.getAttribute('data-x')) || 0);
                    let y = (parseFloat(target.getAttribute('data-y')) || 0);

                    target.style.width = `${event.rect.width}px`;
                    target.style.height = `${event.rect.height}px`;

                    // Update the position based on the resize
                    x += event.deltaRect.left;
                    y += event.deltaRect.top;

                    target.style.transform = `translate(${x}px, ${y}px)`;
                    target.setAttribute('data-x', x);
                    target.setAttribute('data-y', y);

                    // Update signaturePageInfo with current dimensions
                    if (signaturePageInfo) {
                        signaturePageInfo.width = event.rect.width;
                        signaturePageInfo.height = event.rect.height;
                    }
                }
            },
            modifiers: [
                interact.modifiers.aspectRatio({
                    ratio: 'preserve'
                }),
                // Optionally add restrictRect to keep it within the canvas
                // interact.modifiers.restrictRect({
                //     restriction: 'parent' // This would restrict to pdfViewer, not specific canvas
                // })
            ]
        })
        .draggable({
            listeners: {
                move(event) {
                    const target = event.target;
                    const x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx;
                    const y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;
                    
                    target.style.transform = `translate(${x}px, ${y}px)`;
                    target.setAttribute('data-x', x);
                    target.setAttribute('data-y', y);
                },
                // Add an end listener to update signaturePageInfo after drag
                end(event) {
                    if (signaturePageInfo) {
                        const target = event.target;
                        const currentSigX = (parseFloat(target.getAttribute('data-x')) || 0);
                        const currentSigY = (parseFloat(target.getAttribute('data-y')) || 0);

                        // Recalculate signature's position relative to its canvas
                        signaturePageInfo.x = currentSigX - signaturePageInfo.canvas.offsetLeft;
                        signaturePageInfo.y = currentSigY - signaturePageInfo.canvas.offsetTop;

                        // Check if the signature has been dragged off its original page
                        // This is a more complex check, but critical for multi-page PDFs
                        const canvases = pdfViewer.querySelectorAll('.pdf-page-canvas');
                        let newTargetCanvas = null;
                        for (const canvas of canvases) {
                            const rect = canvas.getBoundingClientRect();
                            const sigRect = target.getBoundingClientRect();
                            
                            // Check for significant overlap or if signature center is on new canvas
                            if (sigRect.left < rect.right && sigRect.right > rect.left &&
                                sigRect.top < rect.bottom && sigRect.bottom > rect.top) {
                                
                                // Simple check: if the signature's top-left is within this canvas
                                if (currentSigX >= canvas.offsetLeft && currentSigX <= (canvas.offsetLeft + canvas.offsetWidth) &&
                                    currentSigY >= canvas.offsetTop && currentSigY <= (canvas.offsetTop + canvas.offsetHeight)) {
                                    newTargetCanvas = canvas;
                                    break;
                                }
                            }
                        }

                        if (newTargetCanvas && newTargetCanvas !== signaturePageInfo.canvas) {
                            console.log(`Signature moved from page ${signaturePageInfo.pageNumber} to page ${newTargetCanvas.dataset.pageNumber}`);
                            signaturePageInfo.canvas = newTargetCanvas;
                            signaturePageInfo.pageNumber = parseInt(newTargetCanvas.dataset.pageNumber);
                            // Recalculate x,y relative to the new canvas
                            signaturePageInfo.x = currentSigX - newTargetCanvas.offsetLeft;
                            signaturePageInfo.y = currentSigY - newTargetCanvas.offsetTop;
                        }
                    }
                }
            }
        });
});
  </script>
</body>
</html>
