<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MJYDCHGD51"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-MJYDCHGD51');
</script>
    <!-- ============== BASIC META TAGS ============== -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Free eSign PDF Tool | Sign Documents Online</title>
    <meta name="description" content="Sign PDF documents online for free. Upload, draw, and place your signature securely. Fast, private, and no uploads required.">
    <meta name="keywords" content="esign pdf, sign pdf, electronic signature, sign document online, free pdf signer, draw signature on pdf, online signature tool">
    
    <!-- ============== SEO & SOCIAL META TAGS ============== -->
    <link rel="canonical" href="https://toolsbucket.online/esign-pdf.html">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="48x48" href="/favicon-48x48.png">
	<link rel="icon" type="image/png" sizes="64x64" href="/favicon-64x64.png">
	<link rel="icon" type="image/png" sizes="192x192" href="/favicon-192x192.png">
	<link rel="icon" type="image/png" sizes="512x512" href="/favicon-512x512.png">
	<link rel="apple-touch-icon" sizes="180x180" href="/favicon-192x192.png">
	<meta name="theme-color" content="#ffffff">
    <meta property="og:title" content="Free Online PDF eSigning Tool">
    <meta property="og:description" content="Easily add your signature to any PDF document. Our tool works in your browser, keeping your files secure and private.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://toolsbucket.online/esign-pdf.html">
    <meta property="og:image" content="https://toolsbucket.online/og-image.png">
	<!-- Twitter Card meta tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@ToolsBucket2025"> <!-- Replace with your Twitter username -->
  <meta name="twitter:title" content="ToolsBucket - Free Online Tools">
  <meta name="twitter:description" content="A collection of free, fast, and secure online utilities for PDFs, images, text, and web development.">
  <meta name="twitter:image" content="https://toolsbucket.online/ToolsBucket_banner.jpg"> <!-- Replace with your image URL -->

    <!-- Libraries -->
    <script src="https://unpkg.com/pdf-lib"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/signature_pad/1.5.3/signature_pad.min.js"></script>
    <script src="https://unpkg.com/file-saver@2.0.5/dist/FileSaver.min.js"></script>

    <!-- ============== STYLES & FONTS ============== -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Dancing+Script&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #007BFF;
            --background-color: #f4faff;
            --card-background: #ffffff;
            --text-color: #333;
            --heading-color: #0056b3;
            --border-color: #ddd;
            --shadow-color: rgba(0, 123, 255, 0.1);
            --success-color: #28a745;
            --error-color: #dc3545;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Poppins', Arial, sans-serif;
            background: var(--background-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        
        .page-header {
            width: 100%;
            max-width: 900px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .brand-name { font-size: 1.8em; font-weight: 700; }
        .brand-part-1 { color: var(--primary-color); }
        .brand-part-2 { color: var(--text-color); }
        .back-button {
            text-decoration: none;
            background-color: #e9ecef;
            color: var(--text-color);
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            border: 1px solid var(--border-color);
        }
        
        .main-container { width: 100%; max-width: 900px; }
        .content-section, .tool-container, footer {
            background-color: var(--card-background);
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 8px 25px var(--shadow-color);
            margin-bottom: 30px;
        }
        h1, h2 { color: var(--heading-color); margin-bottom: 15px; text-align: center; }
        h1 { font-size: 2em; }
        h2 { font-size: 1.6em; }
        h3 { margin-top: 20px; margin-bottom: 10px; text-align: left; }
        p, li { line-height: 1.7; text-align: left; }
        ul { margin-left: 20px; }

        .tool-container { text-align: center; }
        #upload-section .upload-area {
            border: 3px dashed var(--border-color);
            border-radius: 10px;
            padding: 40px;
            cursor: pointer;
            transition: background-color 0.3s, border-color 0.3s;
        }
        #upload-section .upload-area.dragover { background-color: #e6f2ff; border-color: var(--primary-color); }
        input[type="file"] { display: none; }
        
        .btn {
            background-color: var(--primary-color);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 15px;
            font-size: 1em;
            font-weight: 600;
        }
        .btn.secondary { background-color: #6c757d; }
        
        #signing-section { display: none; }
        #pdf-viewer { border: 1px solid var(--border-color); max-height: 500px; overflow-y: auto; position: relative; }
        #pdf-viewer canvas { max-width: 100%; display: block; margin: 10px auto; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        #draggable-signature { position: absolute; cursor: move; border: 1px dashed var(--primary-color); z-index: 100; }

        #signature-modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); }
        .modal-content { background-color: #fff; margin: 10% auto; padding: 20px; border-radius: 10px; max-width: 500px; }
        .tabs { border-bottom: 1px solid var(--border-color); margin-bottom: 15px; }
        .tab-button { background: none; border: none; padding: 10px 15px; cursor: pointer; font-size: 1em; }
        .tab-button.active { border-bottom: 3px solid var(--primary-color); font-weight: 600; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        #draw-tab canvas { border: 1px solid var(--border-color); cursor: crosshair; }
        #type-tab input { width: 100%; padding: 10px; font-size: 1.5em; font-family: 'Dancing Script', cursive; }
        
        #download-section { display: none; }
        #status { min-height: 24px; font-weight: 600; margin-top: 10px;}
        
         /* === NEW FOOTER STYLES === */
        footer {
            text-align: center;
            padding-top: 20px;
            padding-bottom: 20px;
        }
        footer h3 {
            font-size: 1.1em;
            font-weight: 600;
            color: var(--text-color);
            margin-top: 0;
            margin-bottom: 15px;
            text-align: center; /* Center align the Quick Links heading */
        }
        footer ul {
            list-style: none;
            padding: 0;
            margin: 0 0 20px 0;
            display: flex; /* Use flexbox for horizontal alignment */
            justify-content: center; /* Center the list items */
            flex-wrap: wrap; /* Allow items to wrap on smaller screens */
        }
        footer li {
            display: inline-block;
            margin: 0 12px;
        }
        footer a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 600;
            font-size: 1em;
        }
        footer .footer-bottom p {
            font-size: 0.9em;
            color: #888;
            margin: 0;
            text-align: center; /* Center align the copyright text */
        }
        /* === END NEW FOOTER STYLES === */
    </style>

    <!-- ============== STRUCTURED DATA (SCHEMA MARKUP) ============== -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "Free eSign PDF Tool",
      "applicationCategory": "BusinessApplication",
      "operatingSystem": "Any (Web-based)",
      "offers": { "@type": "Offer", "price": "0" },
      "description": "A free, secure, client-side tool to add electronic signatures to PDF documents. Supports drawing, typing, and uploading signatures."
    }
    </script>
<!========Ads Section ===========>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5037596819589415"
     crossorigin="anonymous"></script>
    <!=========Ads Section ===========>
</head>
<body>
  <header class="page-header">
      <a href="index.html" class="back-button">← Back to Tools</a>
      <div class="brand-name">
          <span class="brand-part-1">Tools</span><span class="brand-part-2">Bucket</span>
      </div>
  </header>

  <main class="main-container">
    <section class="content-section">
        <h1>Free eSign PDF Online: Securely Sign Documents in Your Browser</h1>
        <p style="text-align:center;">In today's fast-paced digital world, the need to sign documents electronically has become indispensable. Our **Free eSign PDF Online tool** at ToolsBucket.online offers a seamless, secure, and incredibly user-friendly solution to add electronic signatures to your PDF documents without ever leaving your web browser. Forget about printing, signing by hand, scanning, and re-uploading. Our powerful online PDF signer streamlines the entire process, allowing you to digitally sign contracts, agreements, forms, and any other PDF files with ease and confidence. Best of all, it's completely free and prioritizes your privacy by processing all files locally on your device, ensuring that your sensitive documents are never uploaded to our servers.</p>

        <p style="text-align:center;">Whether you're a professional needing to quickly finalize a business deal, a student submitting an application, or an individual managing personal paperwork, our eSign PDF tool is designed for everyone. It supports multiple methods for creating your signature—you can draw it with your mouse or touchpad, type it out in a stylish font, or even upload an image of your existing handwritten signature. Once created, you get full control to place, resize, and position your signature anywhere on your PDF document. Experience the convenience of modern document management with ToolsBucket's free eSign PDF tool.</p>
    </section>
<!================Ads Section================>
<script type="text/javascript">
	atOptions = {
		'key' : 'ccc0093d01f3c0d6f08625bae6e22475',
		'format' : 'iframe',
		'height' : 90,
		'width' : 728,
		'params' : {}
	};
</script>
<script type="text/javascript" src="//www.highperformanceformat.com/ccc0093d01f3c0d6f08625bae6e22475/invoke.js"></script>
    <!================Ads Section================>
    <div class="tool-container">
        <!-- Step 1: Upload -->
        <div id="upload-section">
            <h2>Sign Your PDF Document</h2>
            <div id="uploadArea" class="upload-area">
                <p>Drag & drop your PDF here, or click to select a file.</p>
                <p id="fileName" style="font-weight: bold;"></p>
            </div>
            <input type="file" id="pdfInput" accept="application/pdf">
        </div>

        <!-- Step 2: Signing Workspace -->
        <div id="signing-section">
            <h2>Place Your Signature</h2>
            <div id="pdf-viewer"></div>
            <p>Click "Add Signature" to create your signature, then drag it onto the document.</p>
            <button id="addSignatureBtn" class="btn">Add Signature</button>
            <button id="finalizeBtn" class="btn" style="background-color: var(--success-color);">Apply & Continue</button>
        </div>

        <!-- Step 3: Download -->
        <div id="download-section">
             <h2>Download Your Signed PDF</h2>
             <p>Your document is ready. Click the button below to download.</p>
             <button id="downloadBtn" class="btn">Download Signed PDF</button>
             <button id="startOverBtn" class="btn secondary">Start Over</button>
        </div>
        
        <div id="status"></div>
    </div>
    
    <!-- Signature Modal -->
    <div id="signature-modal">
        <div class="modal-content">
            <h3>Create Your Signature</h3>
            <div class="tabs">
                <button class="tab-button active" data-tab="draw-tab">Draw</button>
                <button class="tab-button" data-tab="type-tab">Type</button>
                <button class="tab-button" data-tab="upload-tab">Upload</button>
            </div>
            <div id="draw-tab" class="tab-content active">
                <canvas id="signature-canvas" width="460" height="200"></canvas>
                <button id="clear-signature" class="btn secondary">Clear</button>
            </div>
            <div id="type-tab" class="tab-content">
                <input type="text" id="type-signature-input" placeholder="Type your name">
            </div>
            <div id="upload-tab" class="tab-content">
                <label for="upload-signature-input" class="btn secondary">Choose Image (PNG/JPG)</label>
                <input type="file" id="upload-signature-input" accept="image/png, image/jpeg">
                <img id="signature-preview" style="max-width: 100%; max-height: 100px; margin-top: 10px; display: none;" alt="Signature Preview"/>
            </div>
            <button id="apply-signature" class="btn" style="margin-top:20px;">Apply Signature</button>
        </div>
    </div>
<!========Ads Section ===========>
    <script async="async" data-cfasync="false" src="//pl27456121.revenuecpmgate.com/b589d3ed3b615decf33376b5b2d2ab8a/invoke.js"></script>
<div id="container-b589d3ed3b615decf33376b5b2d2ab8a"></div>
    <!=========Ads Section ===========>
    <section class="content-section">
        <h2>How to Use Our Free eSign PDF Tool</h2>
        <p>Our online PDF signer is designed for simplicity and efficiency. Follow these straightforward steps to sign your documents in minutes:</p>
        <ol>
            <li><strong>Upload Your PDF:</strong> Begin by dragging and dropping your PDF file into the designated upload area. Alternatively, you can click the area to browse and select a file from your device. Remember, your file never leaves your browser, ensuring maximum privacy.</li>
            <li><strong>Create Your Signature:</strong> Once your PDF is loaded, click the "Add Signature" button. A modal window will appear, presenting you with three options:
                <ul>
                    <li><strong>Draw:</strong> Use your mouse or touchpad to draw your signature directly on the canvas.</li>
                    <li><strong>Type:</strong> Type your name, and our tool will convert it into a stylish, script-like signature.</li>
                    <li><strong>Upload:</strong> If you have a scanned image of your signature (PNG or JPG), you can upload it here.</li>
                </ul>
                After creating your signature, click "Apply Signature."</li>
            <li><strong>Place Your Signature:</strong> Your newly created signature will appear on the PDF viewer. You can then drag and drop it to your desired position on any page of the document. Feel free to resize it to fit perfectly within the designated signature field.</li>
            <li><strong>Finalize and Download:</strong> Once your signature is precisely where you want it, click "Apply & Continue." The tool will then process your document, embedding the signature. Finally, click "Download Signed PDF" to save the completed document to your device. You can also click "Start Over" if you need to sign another document or wish to make changes.</li>
        </ol>

        <h2>Benefits of Using Our Online PDF Signer</h2>
        <p>Choosing ToolsBucket's eSign PDF tool comes with a multitude of advantages:</p>
        <ul>
            <li><strong>Completely Free:</strong> Enjoy full access to all features without any hidden costs, subscriptions, or limitations on file size or usage.</li>
            <li><strong>Unmatched Privacy:</strong> We prioritize your data security. All PDF processing and signature creation happen client-side, directly in your web browser. Your sensitive documents are never uploaded to our servers, ensuring complete confidentiality.</li>
            <li><strong>User-Friendly Interface:</strong> Our intuitive design makes it easy for anyone, regardless of technical expertise, to sign documents quickly and efficiently.</li>
            <li><strong>Versatile Signature Options:</strong> Whether you prefer to draw, type, or upload your signature, our tool provides flexible methods to create the perfect e-signature.</li>
            <li><strong>Drag-and-Drop Functionality:</strong> Easily position and resize your signature on the document with simple drag-and-drop actions, giving you precise control.</li>
            <li><strong>Instant Results:</strong> Sign and download your PDF in a matter of seconds, saving you valuable time and effort compared to traditional signing methods.</li>
            <li><strong>Cross-Platform Compatibility:</strong> Our web-based tool works seamlessly on any operating system and browser, from Windows and macOS to Linux, and on mobile devices.</li>
            <li><strong>Environmentally Friendly:</strong> Go paperless and contribute to a greener planet by reducing paper consumption and printing waste.</li>
            <li><strong>Legally Compliant:</strong> Electronic signatures generated with our tool can be legally binding, depending on your local regulations (e.g., eIDAS in Europe, ESIGN Act in the US).</li>
        </ul>

        <h2>Frequently Asked Questions (FAQs)</h2>
        <h3>Is this eSign PDF tool really free?</h3>
        <p>Yes, absolutely! Our eSign PDF tool is 100% free to use, with no hidden costs, subscriptions, or limits on the number of documents you can sign.</p>

        <h3>Is it safe to use an online tool to sign my PDF documents?</h3>
        <p>Yes, our tool is exceptionally safe. A key feature of ToolsBucket's eSign PDF is that all processing, including uploading and signing, occurs directly in your web browser. Your PDF files and signatures are never sent to or stored on our servers, ensuring your privacy and data security.</p>

        <h3>What types of signatures can I create?</h3>
        <p>You have three convenient options: you can draw your signature using your mouse or trackpad, type your name to generate a stylized signature, or upload an image of your existing handwritten signature (PNG or JPG format).</p>

        <h3>Can I resize and move my signature after creating it?</h3>
        <p>Yes. Once you apply your signature, it appears on the PDF viewer as a draggable element. You can easily drag it to any position on the document and resize it to fit perfectly using its corner handles.</p>

        <h3>Do electronic signatures hold legal validity?</h3>
        <p>In many regions worldwide, electronic signatures are legally binding, especially for standard document types. Laws like the ESIGN Act in the United States and eIDAS Regulation in the European Union recognize the legal validity of e-signatures. Always check local regulations if you have specific legal concerns.</p>

        <h3>What if my PDF has multiple pages?</h3>
        <p>Our tool renders all pages of your PDF document. You can scroll through the document and place your signature on any desired page. The drag-and-drop functionality allows precise placement on the chosen page.</p>

        <h3>Do I need to install any software or plugins?</h3>
        <p>No, our eSign PDF tool is entirely web-based. You only need a modern web browser (like Chrome, Firefox, Edge, Safari, etc.) and an internet connection. No downloads or installations are required.</p>

        <h3>What file formats are supported for signature upload?</h3>
        <p>When uploading an existing signature, our tool supports common image formats such as PNG and JPG.</p>

        <h3>What happens if I make a mistake while drawing my signature?</h3>
        <p>Don't worry! Within the signature creation modal, there's a "Clear" button that allows you to erase your drawn signature and start over as many times as you need until you get it just right.</p>

        <p style="text-align:center;">Empower your workflow and simplify your document signing process with ToolsBucket's Free eSign PDF Online tool. It's fast, secure, private, and designed with your needs in mind. Try it today and experience the future of digital document signing!</p>
    </section>
	  <!================ Ads Section =============>
<script type="text/javascript">
	atOptions = {
		'key' : 'e25f82d7e66e0898049dce93facd48c7',
		'format' : 'iframe',
		'height' : 50,
		'width' : 320,
		'params' : {}
	};
</script>
<script type="text/javascript" src="//www.highperformanceformat.com/e25f82d7e66e0898049dce93facd48c7/invoke.js"></script>
    <!================Ads Section================>
    <!-- === NEW FOOTER HTML === -->
    <footer id="contact">
        <h3>Quick Links</h3>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="index.html#tools">All Tools</a></li>
            <li><a href="privacy-policy.html">Privacy Policy</a></li>
            <li><a href="terms-&-conditions.html">Terms of Use</a></li>
            <li><a href="about.html">About Us</a></li>
        </ul>
        <div class="footer-bottom">
            <p>© 2025 ToolsBucket. All rights reserved.</p>
        </div>
    </footer>
    <!-- === END NEW FOOTER HTML === -->
  </main>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
        const { PDFDocument } = PDFLib;

        // Global state
        let pdfFileBytes = null;
        let originalFileName = '';
        let signature = { dataUrl: null, type: null };
        let signaturePosition = null;
        let pdfPageDimensions = [];

        // DOM Elements
        const uploadSection = document.getElementById('upload-section');
        const signingSection = document.getElementById('signing-section');
        const downloadSection = document.getElementById('download-section');
        const pdfInput = document.getElementById('pdfInput');
        const uploadArea = document.getElementById('uploadArea');
        const fileNameEl = document.getElementById('fileName');
        const pdfViewer = document.getElementById('pdf-viewer');
        const addSignatureBtn = document.getElementById('addSignatureBtn');
        const finalizeBtn = document.getElementById('finalizeBtn');
        const signatureModal = document.getElementById('signature-modal');
        const signatureCanvas = document.getElementById('signature-canvas');
        const typeInput = document.getElementById('type-signature-input');
        const uploadSignatureInput = document.getElementById('upload-signature-input');
        const signaturePreview = document.getElementById('signature-preview');
        const applySignatureBtn = document.getElementById('apply-signature');
        const clearSignatureBtn = document.getElementById('clear-signature');
        const downloadBtn = document.getElementById('downloadBtn');
        const startOverBtn = document.getElementById('startOverBtn');
        const statusEl = document.getElementById('status');
        
        const signaturePad = new SignaturePad(signatureCanvas);
        
        const setStatus = (message, type) => {
            statusEl.textContent = message;
            statusEl.style.color = type === 'success' ? 'var(--success-color)' : type === 'error' ? 'var(--error-color)' : 'var(--heading-color)';
        };

        const resetAll = () => {
            pdfFileBytes = null; originalFileName = ''; signature = { dataUrl: null, type: null };
            signaturePosition = null; pdfPageDimensions = []; pdfInput.value = '';
            fileNameEl.textContent = ''; pdfViewer.innerHTML = '';
            uploadSection.style.display = 'block'; signingSection.style.display = 'none';
            downloadSection.style.display = 'none'; setStatus('', 'info');
        };

        const handleFile = (file) => {
            if (!file || file.type !== 'application/pdf') return alert('Please select a valid PDF file.');
            originalFileName = file.name; fileNameEl.textContent = `Selected: ${originalFileName}`;
            const reader = new FileReader();
            reader.onload = async (e) => {
                pdfFileBytes = new Uint8Array(e.target.result);
                await renderPdf(pdfFileBytes);
                uploadSection.style.display = 'none'; signingSection.style.display = 'block';
            };
            reader.readAsArrayBuffer(file);
        };

        uploadArea.addEventListener('click', () => pdfInput.click());
        pdfInput.addEventListener('change', (e) => handleFile(e.target.files[0]));
        startOverBtn.addEventListener('click', resetAll);
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => uploadArea.addEventListener(eventName, e => { e.preventDefault(); e.stopPropagation(); }));
        ['dragenter', 'dragover'].forEach(eventName => uploadArea.addEventListener(eventName, () => uploadArea.classList.add('dragover')));
        ['dragleave', 'drop'].forEach(eventName => uploadArea.addEventListener(eventName, () => uploadArea.classList.remove('dragover')));
        uploadArea.addEventListener('drop', (e) => handleFile(e.dataTransfer.files[0]));
        
        const renderPdf = async (data) => {
            const pdf = await pdfjsLib.getDocument(data).promise;
            pdfViewer.innerHTML = ''; pdfPageDimensions = [];
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const originalViewport = page.getViewport({ scale: 1.0 });
                pdfPageDimensions.push({ width: originalViewport.width, height: originalViewport.height });
                const viewport = page.getViewport({ scale: 1.5 });
                const canvas = document.createElement('canvas');
                canvas.dataset.pageNumber = i;
                canvas.height = viewport.height; canvas.width = viewport.width;
                const context = canvas.getContext('2d');
                await page.render({ canvasContext: context, viewport: viewport }).promise;
                pdfViewer.appendChild(canvas);
            }
        };

        addSignatureBtn.addEventListener('click', () => {
            signaturePad.clear(); typeInput.value = ''; uploadSignatureInput.value = '';
            signaturePreview.style.display = 'none'; signaturePreview.src = '';
            signature = { dataUrl: null, type: null }; signatureModal.style.display = 'block';
        });
        
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', () => {
                document.querySelector('.tab-button.active').classList.remove('active');
                document.querySelector('.tab-content.active').classList.remove('active');
                button.classList.add('active');
                document.getElementById(button.dataset.tab).classList.add('active');
            });
        });
        
        clearSignatureBtn.addEventListener('click', () => signaturePad.clear());
        
        uploadSignatureInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file || (!file.type.startsWith('image/png') && !file.type.startsWith('image/jpeg'))) {
                alert('Please upload a valid PNG or JPG image.');
                return;
            }
            const reader = new FileReader();
            reader.onload = (event) => {
                signature.dataUrl = event.target.result; 
                signature.type = file.type;
                signaturePreview.src = event.target.result;
                signaturePreview.style.display = 'block';
            };
            reader.readAsDataURL(file);
        });

        applySignatureBtn.addEventListener('click', () => {
            const activeTab = document.querySelector('.tab-content.active').id;
            
            if (activeTab === 'draw-tab' && !signaturePad.isEmpty()) {
                signature.dataUrl = signaturePad.toDataURL();
                signature.type = 'image/png';
            } else if (activeTab === 'type-tab' && typeInput.value.trim()) {
                signature.dataUrl = createSignatureFromText(typeInput.value);
                signature.type = 'image/png';
            }
            
            if (signature.dataUrl) {
                addDraggableSignature(signature.dataUrl);
                signatureModal.style.display = 'none';
            } else {
                alert("Please create or upload a signature first.");
            }
        });
        
        const createSignatureFromText = (text) => {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 400; canvas.height = 100;
            ctx.font = "50px 'Dancing Script', cursive";
            ctx.fillText(text, 10, 70);
            return canvas.toDataURL();
        };

        const addDraggableSignature = (dataUrl) => {
            let existingSig = document.getElementById('draggable-signature');
            if(existingSig) existingSig.remove();
            const img = document.createElement('img');
            img.src = dataUrl; img.id = 'draggable-signature'; img.style.width = '150px';
            pdfViewer.appendChild(img);
            
            let pos = { x: 0, y: 0, currentX: 0, currentY: 0 };
            img.onmousedown = (e) => {
                e.preventDefault();
                pos.currentX = e.clientX; pos.currentY = e.clientY;
                document.onmouseup = () => document.onmouseup = document.onmousemove = null;
                document.onmousemove = (e) => {
                    e.preventDefault();
                    pos.x = pos.currentX - e.clientX; pos.y = pos.currentY - e.clientY;
                    pos.currentX = e.clientX; pos.currentY = e.clientY;
                    img.style.top = (img.offsetTop - pos.y) + "px";
                    img.style.left = (img.offsetLeft - pos.x) + "px";
                };
            };
        };
        
        finalizeBtn.addEventListener('click', () => {
            const signatureEl = document.getElementById('draggable-signature');
            if (!signatureEl) return alert("Please add and place your signature first.");
            
            const sigRect = signatureEl.getBoundingClientRect();
            const canvases = Array.from(pdfViewer.querySelectorAll('canvas'));
            const targetCanvas = canvases.find(canvas => {
                const canvasRect = canvas.getBoundingClientRect();
                return sigRect.top >= canvasRect.top && sigRect.bottom <= canvasRect.bottom + 5;
            });
            
            if (!targetCanvas) return alert("Please place the signature fully within a single page.");

            const pageNum = parseInt(targetCanvas.dataset.pageNumber);
            const pageRect = targetCanvas.getBoundingClientRect();
            const originalPage = pdfPageDimensions[pageNum - 1];
            const scaleX = originalPage.width / pageRect.width;
            const scaleY = originalPage.height / pageRect.height;
            const sigX_px = sigRect.left - pageRect.left;
            const sigY_px = sigRect.top - pageRect.top;
            const finalX = sigX_px * scaleX;
            const finalY = originalPage.height - (sigY_px * scaleY) - (sigRect.height * scaleY);
            const finalWidth = sigRect.width * scaleX;
            const finalHeight = sigRect.height * scaleY;

            signaturePosition = { pageNum: pageNum - 1, x: finalX, y: finalY, width: finalWidth, height: finalHeight };
            
            signatureEl.remove();
            signingSection.style.display = 'none';
            downloadSection.style.display = 'block';
        });

        downloadBtn.addEventListener('click', async () => {
            if (!pdfFileBytes) return;
            downloadBtn.disabled = true;
            setStatus('Applying signature and saving...', 'info');
            
            try {
                const pdfDoc = await PDFDocument.load(pdfFileBytes);
                const signatureBytes = await fetch(signature.dataUrl).then(res => res.arrayBuffer());
                
                let signatureImage;
                if (signature.type === 'image/jpeg') {
                    signatureImage = await pdfDoc.embedJpg(signatureBytes);
                } else {
                    signatureImage = await pdfDoc.embedPng(signatureBytes);
                }
                
                const pos = signaturePosition;
                const page = pdfDoc.getPages()[pos.pageNum];
                page.drawImage(signatureImage, { x: pos.x, y: pos.y, width: pos.width, height: pos.height });

                const finalPdfBytes = await pdfDoc.save();
                const blob = new Blob([finalPdfBytes], { type: 'application/pdf' });
                const signedFileName = originalFileName.replace(/\.pdf$/i, '_signed.pdf');
                saveAs(blob, signedFileName);
                setStatus('Your signed PDF has been downloaded!', 'success');
            } catch (e) {
                console.error("Saving Error:", e);
                setStatus('An error occurred while saving the PDF. Please try again.', 'error');
            } finally {
                downloadBtn.disabled = false;
            }
        });
    });
  </script>

</body>
</html>
